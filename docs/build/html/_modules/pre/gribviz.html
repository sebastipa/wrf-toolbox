

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pre.gribviz &mdash; wrf-toolbox 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            wrf-toolbox
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">pre</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pre.html">pre package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">wrf-toolbox</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pre.gribviz</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pre.gribviz</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">metview</span> <span class="k">as</span> <span class="nn">mv</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span>   <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span>   <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="c1"># gribviz.py  : a Python module to help in WRF simulation preprocessing by extracting statistics </span>
<span class="c1">#               and visualizing data from grib files</span>
<span class="c1"># classes     : gribdata</span>
<span class="c1"># author      : Sebastiano Stipa</span>
<span class="c1"># date        : 27-11-2024</span>

<div class="viewcode-block" id="gribdata">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata">[docs]</a>
<span class="k">class</span> <span class="nc">gribdata</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to represent and manipulate GRIB data for WRF simulation preprocessing.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    day_range : list of int</span>
<span class="sd">        The range of days to process.</span>
<span class="sd">    month_range : list of int</span>
<span class="sd">        The range of months to process.</span>
<span class="sd">    year_range : list of int</span>
<span class="sd">        The range of years to process.</span>
<span class="sd">    prefix : str</span>
<span class="sd">        The prefix for the filenames.</span>
<span class="sd">    extension : str</span>
<span class="sd">        The extension for the filenames.</span>
<span class="sd">    path : str</span>
<span class="sd">        The path to the directory containing the GRIB files.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># dummy initialization</span>
    <span class="n">start_day</span>     <span class="o">=</span> <span class="mi">1</span>
    <span class="n">end_day</span>       <span class="o">=</span> <span class="mi">1</span>
    <span class="n">start_month</span>   <span class="o">=</span> <span class="mi">1</span>
    <span class="n">end_month</span>     <span class="o">=</span> <span class="mi">1</span>
    <span class="n">start_year</span>    <span class="o">=</span> <span class="mi">2022</span>
    <span class="n">end_year</span>      <span class="o">=</span> <span class="mi">2022</span>
    <span class="n">path</span>          <span class="o">=</span> <span class="s2">&quot;/storage/wrf/nobackup/munters/ERA5&quot;</span>
    <span class="n">prefix</span>        <span class="o">=</span> <span class="s2">&quot;levels&quot;</span>
    <span class="n">extension</span>     <span class="o">=</span> <span class="s2">&quot;grib&quot;</span>
    
    <span class="c1"># constants </span>
    <span class="n">days_in_month</span> <span class="o">=</span> <span class="p">[</span><span class="mi">31</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">]</span>
    <span class="n">monts_in_year</span> <span class="o">=</span> <span class="mi">12</span> 

    <span class="c1"># class constructor</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day_range</span> <span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
                 <span class="n">month_range</span>     <span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
                 <span class="n">year_range</span>      <span class="o">=</span><span class="p">[</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">2022</span><span class="p">],</span>
                 <span class="n">prefix</span>          <span class="o">=</span><span class="s2">&quot;levels&quot;</span><span class="p">,</span> 
                 <span class="n">extension</span>       <span class="o">=</span><span class="s2">&quot;grib&quot;</span><span class="p">,</span> 
                 <span class="n">path</span>            <span class="o">=</span><span class="s2">&quot;/storage/wrf/nobackup/munters/ERA5/&quot;</span>
                 <span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs all the necessary attributes for the gribdata object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        day_range : list of int, optional</span>
<span class="sd">            The range of days to process (default is [1, 1]).</span>
<span class="sd">        month_range : list of int, optional</span>
<span class="sd">            The range of months to process (default is [1, 1]).</span>
<span class="sd">        year_range : list of int, optional</span>
<span class="sd">            The range of years to process (default is [2022, 2022]).</span>
<span class="sd">        prefix : str, optional</span>
<span class="sd">            The prefix for the filenames (default is &quot;levels&quot;). :noindex:</span>
<span class="sd">        extension : str, optional</span>
<span class="sd">            The extension for the filenames (default is &quot;grib&quot;). :noindex:</span>
<span class="sd">        path : str, optional</span>
<span class="sd">            The path to the directory containing the GRIB files (default is &quot;/storage/wrf/nobackup/munters/ERA5/&quot;). :noindex:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check that starting date exists </span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">datetime</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">month_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">day_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">start_exists</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">start_exists</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">datetime</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">month_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">day_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">end_exists</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">end_exists</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">start_exists</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid start date&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">end_exists</span><span class="p">:</span>  
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid end date&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">month_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">day_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">month_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">day_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start date is after end date&quot;</span><span class="p">)</span>
        
        <span class="c1"># assign values to class variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_day</span>   <span class="o">=</span> <span class="n">day_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_day</span>     <span class="o">=</span> <span class="n">day_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_month</span> <span class="o">=</span> <span class="n">month_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_month</span>   <span class="o">=</span> <span class="n">month_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_year</span>  <span class="o">=</span> <span class="n">year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_year</span>    <span class="o">=</span> <span class="n">year_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span>        <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>      <span class="o">=</span> <span class="n">prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extension</span>   <span class="o">=</span> <span class="n">extension</span>	
        <span class="k">return</span>

    <span class="c1"># return an array of filenames ordered by date </span>
<div class="viewcode-block" id="gribdata.get_filenames">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.get_filenames">[docs]</a>
    <span class="k">def</span> <span class="nf">get_filenames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of filenames ordered by date.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of str</span>
<span class="sd">            The list of filenames ordered by date.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start</span>    <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_day</span><span class="p">)</span>
        <span class="n">end</span>      <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_day</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span>
            <span class="n">year</span>  <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">year</span>
            <span class="n">month</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">month</span>
            <span class="n">day</span>   <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">day</span>
            <span class="n">start</span> <span class="o">+=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.grib&quot;</span><span class="p">)</span>
               
        <span class="k">return</span> <span class="n">filenames</span>  </div>

    
<div class="viewcode-block" id="gribdata.copy_files_to_dir">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.copy_files_to_dir">[docs]</a>
    <span class="k">def</span> <span class="nf">copy_files_to_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest_dir</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy selected files into the destination folder (when creating WRF case).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dest_dir : str</span>
<span class="sd">            The destination directory where the files will be copied.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filenames</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copying </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> --&gt; </span><span class="si">{</span><span class="n">dest_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cp </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">dest_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span></div>

    
<div class="viewcode-block" id="gribdata.link_files_to_dir">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.link_files_to_dir">[docs]</a>
    <span class="k">def</span> <span class="nf">link_files_to_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest_dir</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Link selected files into the destination folder (when creating WRF case).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dest_dir : str</span>
<span class="sd">            The destination directory where the files will be linked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filenames</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Linking </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> --&gt; </span><span class="si">{</span><span class="n">dest_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ln -s </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">dest_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span></div>

    
    <span class="c1"># inspect the data in the grib files</span>
<div class="viewcode-block" id="gribdata.inspect">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.inspect">[docs]</a>
    <span class="k">def</span> <span class="nf">inspect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inspect the current dataset in the GRIB files and print information.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filenames</span><span class="p">()</span>
        <span class="n">fs</span>        <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">df</span>        <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;step&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span> <span class="n">extra_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
        <span class="k">return</span></div>


    <span class="c1"># compute min max lat and lon </span>
<div class="viewcode-block" id="gribdata.get_min_max_lat_lon">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.get_min_max_lat_lon">[docs]</a>
    <span class="k">def</span> <span class="nf">get_min_max_lat_lon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the minimum and maximum latitude and longitude of the current dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            The minimum and maximum latitude and longitude as (min_lat, max_lat, min_lon, max_lon).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filenames</span><span class="p">()</span>
        <span class="n">g</span>         <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">==</span> <span class="s2">&quot;levels&quot;</span><span class="p">):</span>
            <span class="n">f</span>     <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">param</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">levelist</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">==</span> <span class="s2">&quot;single&quot;</span><span class="p">):</span>
            <span class="n">f</span>     <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">param</span> <span class="o">=</span> <span class="s1">&#39;sp&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid prefix&quot;</span><span class="p">)</span>
            
        <span class="n">lats</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">latitudes</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">longitudes</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        
        <span class="n">max_lat</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
        <span class="n">min_lat</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
        <span class="n">max_lon</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
        <span class="n">min_lon</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;min_lat: </span><span class="si">{</span><span class="n">min_lat</span><span class="si">}</span><span class="s2">, max_lat: </span><span class="si">{</span><span class="n">max_lat</span><span class="si">}</span><span class="s2">, min_lon: </span><span class="si">{</span><span class="n">min_lon</span><span class="si">}</span><span class="s2">, max_lon: </span><span class="si">{</span><span class="n">max_lon</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
         
        <span class="k">return</span> <span class="p">[</span><span class="n">min_lat</span><span class="p">,</span> <span class="n">max_lat</span><span class="p">,</span> <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">]</span>  </div>


    <span class="c1"># get the elevation at a given lat, lon (it doesn&#39;t work very well)</span>
<div class="viewcode-block" id="gribdata.get_elevation">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.get_elevation">[docs]</a>
    <span class="k">def</span> <span class="nf">get_elevation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the elevation at a given latitude and longitude (needs more testing).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lat : float</span>
<span class="sd">            The latitude of the location.</span>
<span class="sd">        lon : float</span>
<span class="sd">            The longitude of the location.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The elevation at the given latitude and longitude.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.open-elevation.com/api/v1/lookup?locations=</span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
                    <span class="n">elevation</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;elevation&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">elevation</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No elevation data found for the given location.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to connect to the API. Status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>

        
    
    <span class="c1"># extract the time series of a wind speed at a given pressure level</span>
<div class="viewcode-block" id="gribdata.windspeed_extract_timeseries_lvl">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.windspeed_extract_timeseries_lvl">[docs]</a>
    <span class="k">def</span> <span class="nf">windspeed_extract_timeseries_lvl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;500&quot;</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the time series of wind speed at a given pressure level.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        level : str</span>
<span class="sd">            The pressure level to extract.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of tuple</span>
<span class="sd">            The time series and wind speed data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">==</span> <span class="s2">&quot;levels&quot;</span><span class="p">):</span>
            <span class="n">filenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filenames</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mv</span><span class="o">.</span><span class="n">exist</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                    <span class="n">g</span>    <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    <span class="n">u</span>    <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="n">levelist</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>
                    <span class="n">v</span>    <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">levelist</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>
                    <span class="n">ws</span>   <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">v</span><span class="o">*</span><span class="n">v</span><span class="p">)</span>
                    <span class="n">ws</span>   <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">grib_set_long</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;paramId&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot open file &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span> 

                <span class="n">times</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">valid_date</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">tv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">ws</span><span class="p">):</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tv</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;windspeed_extract_timeseries_lvl only supports prefix=levels&quot;</span><span class="p">)</span></div>

        
    <span class="c1"># extract the time series of wind speed at 10m</span>
<div class="viewcode-block" id="gribdata.windspeed_extract_timeseries_10m">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.windspeed_extract_timeseries_10m">[docs]</a>
    <span class="k">def</span> <span class="nf">windspeed_extract_timeseries_10m</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the time series of wind speed at 10m.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of tuple</span>
<span class="sd">            The time series and wind speed data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">==</span> <span class="s2">&quot;single&quot;</span><span class="p">):</span>
            <span class="n">filenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filenames</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mv</span><span class="o">.</span><span class="n">exist</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                    <span class="n">g</span>    <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    <span class="n">u</span>    <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="s2">&quot;10u&quot;</span><span class="p">)</span>
                    <span class="n">v</span>    <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="s2">&quot;10v&quot;</span><span class="p">)</span>
                    <span class="n">ws</span>   <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">v</span><span class="o">*</span><span class="n">v</span><span class="p">)</span>
                    <span class="n">ws</span>   <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">grib_set_long</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;paramId&#39;</span><span class="p">,</span> <span class="mi">207</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot open file &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span> 

                <span class="n">times</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">valid_date</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">tv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">ws</span><span class="p">):</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tv</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;windspeed_extract_timeseries_10m only supports prefix=single&quot;</span><span class="p">)</span></div>


    <span class="c1"># extrtact the time series of a scalar variable defined on pressure levels</span>
<div class="viewcode-block" id="gribdata.variable_extract_timeseries_lvl">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.variable_extract_timeseries_lvl">[docs]</a>
    <span class="k">def</span> <span class="nf">variable_extract_timeseries_lvl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;500&quot;</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the time series of a scalar variable defined on pressure levels.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var : str</span>
<span class="sd">            The variable to extract.</span>
<span class="sd">        level : str</span>
<span class="sd">            The pressure level to extract.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of tuple</span>
<span class="sd">            The time series and variable data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">==</span> <span class="s2">&quot;levels&quot;</span><span class="p">):</span>
            <span class="n">filenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filenames</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mv</span><span class="o">.</span><span class="n">exist</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                    <span class="n">g</span>   <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    <span class="n">m</span>   <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">levelist</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot open file &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span> 

                <span class="n">times</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">valid_date</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">tv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tv</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;variable_extract_timeseries_slv only supports prefix=single&quot;</span><span class="p">)</span></div>

        
    <span class="c1"># extrtact the time series of a scalar variable defined on single level</span>
<div class="viewcode-block" id="gribdata.variable_extract_timeseries_slv">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.variable_extract_timeseries_slv">[docs]</a>
    <span class="k">def</span> <span class="nf">variable_extract_timeseries_slv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;sp&quot;</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the time series of a scalar variable defined on single levels.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var : str</span>
<span class="sd">            The variable to extract.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of tuple</span>
<span class="sd">            The time series and variable data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">==</span> <span class="s2">&quot;single&quot;</span><span class="p">):</span>
            <span class="n">filenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filenames</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mv</span><span class="o">.</span><span class="n">exist</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                    <span class="n">g</span>   <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    <span class="n">m</span>   <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">var</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot open file &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span> 

                <span class="n">times</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">valid_date</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">tv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tv</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;variable_extract_timeseries_slv only supports prefix=single&quot;</span><span class="p">)</span></div>


    <span class="c1"># get plotting variables </span>
<div class="viewcode-block" id="gribdata.def_mv_plot_settings">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.def_mv_plot_settings">[docs]</a>
    <span class="k">def</span> <span class="nf">def_mv_plot_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minmax</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines the plot settings to be passed to Metview contour plots mv.plot().</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        minmax : list of float</span>
<span class="sd">            The minimum and maximum values of the variable.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            The view and contour settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cmin</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">minmax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cmax</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">minmax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># get land-sea boundary data  </span>
        <span class="n">coast</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">mcoast</span><span class="p">(</span>
            <span class="n">map_coastline_land_shade</span>        <span class="o">=</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
            <span class="n">map_coastline_land_shade_colour</span> <span class="o">=</span> <span class="s2">&quot;grey&quot;</span><span class="p">,</span>
            <span class="n">map_coastline_sea_shade</span>         <span class="o">=</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
            <span class="n">map_coastline_sea_shade_colour</span>  <span class="o">=</span> <span class="s2">&quot;RGB(0.8944,0.9086,0.933)&quot;</span><span class="p">,</span>
            <span class="n">map_coastline_thickness</span>         <span class="o">=</span>  <span class="mi">2</span><span class="p">,</span>
            <span class="n">map_boundaries</span>                  <span class="o">=</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
            <span class="n">map_boundaries_colour</span>           <span class="o">=</span> <span class="s2">&quot;charcoal&quot;</span><span class="p">,</span>
            <span class="n">map_grid_colour</span>                 <span class="o">=</span> <span class="s2">&quot;charcoal&quot;</span><span class="p">,</span>
            <span class="n">map_grid_longitude_increment</span>    <span class="o">=</span> <span class="mi">10</span>
            <span class="p">)</span>
        
        <span class="c1"># get min max lat and lon</span>
        <span class="p">[</span><span class="n">min_lat</span><span class="p">,</span> <span class="n">max_lat</span><span class="p">,</span> <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_min_max_lat_lon</span><span class="p">()</span>

        <span class="c1"># define the view </span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">geoview</span><span class="p">(</span>
            <span class="n">map_area_definition</span> <span class="o">=</span> <span class="s1">&#39;corners&#39;</span><span class="p">,</span>
            <span class="n">area</span> <span class="o">=</span> <span class="p">[</span><span class="n">min_lat</span><span class="p">,</span> <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lat</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">],</span>
            <span class="n">coastlines</span> <span class="o">=</span> <span class="n">coast</span>
            <span class="p">)</span>
    
        <span class="c1"># define the contour settings</span>
        <span class="n">diff_cont</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">mcont</span><span class="p">(</span>
            <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;on&quot;</span><span class="p">,</span>
            <span class="n">contour</span><span class="o">=</span><span class="s2">&quot;off&quot;</span><span class="p">,</span>
            <span class="n">contour_max_level</span><span class="o">=</span><span class="n">cmax</span><span class="p">,</span>
            <span class="n">contour_min_level</span><span class="o">=</span><span class="n">cmin</span><span class="p">,</span>
            <span class="n">contour_level_selection_type</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
            <span class="n">contour_shade</span><span class="o">=</span><span class="s2">&quot;on&quot;</span><span class="p">,</span>
            <span class="n">contour_shade_technique</span><span class="o">=</span><span class="s2">&quot;grid_shading&quot;</span><span class="p">,</span>
            <span class="n">contour_shade_colour_method</span><span class="o">=</span><span class="s2">&quot;palette&quot;</span><span class="p">,</span>
            <span class="n">contour_shade_palette_name</span><span class="o">=</span><span class="s2">&quot;eccharts_blue_white_red_9&quot;</span><span class="p">,</span>
            <span class="n">grib_scaling_of_retrieved_fields</span><span class="o">=</span><span class="s2">&quot;off&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">view</span><span class="p">,</span> <span class="n">diff_cont</span><span class="p">]</span></div>


    <span class="c1"># create plots of the time series of wind speed at a given pressure level</span>
<div class="viewcode-block" id="gribdata.windspeed_plot_timeseries_lvl">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.windspeed_plot_timeseries_lvl">[docs]</a>
    <span class="k">def</span> <span class="nf">windspeed_plot_timeseries_lvl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path2output</span><span class="o">=</span><span class="s2">&quot;./snapshots_ws&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;500&quot;</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot time series of windspeed at a given level. Data must be defined on pressure levels.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path2output : str</span>
<span class="sd">            The path to the output directory.</span>
<span class="sd">        level : str</span>
<span class="sd">            The pressure level to plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get wind speed at 500 hPa</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">windspeed_extract_timeseries_lvl</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>  

        <span class="c1"># get number of time samples </span>
        <span class="n">n_time_u</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
        
        <span class="c1"># get min max value of the variable</span>
        <span class="n">min_val</span> <span class="o">=</span>  <span class="mf">1000000.0</span>
        <span class="n">max_val</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1000000.0</span>

        <span class="c1"># get min a max value of the variable</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_time_u</span><span class="p">):</span>
            <span class="n">min_val</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">mv</span><span class="o">.</span><span class="n">minvalue</span><span class="p">(</span><span class="n">ws</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_val</span><span class="p">,</span> <span class="n">mv</span><span class="o">.</span><span class="n">maxvalue</span><span class="p">(</span><span class="n">ws</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># define plot settings </span>
        <span class="p">[</span><span class="n">view</span><span class="p">,</span> <span class="n">diff_cont</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">def_mv_plot_settings</span><span class="p">(</span><span class="n">minmax</span><span class="o">=</span><span class="p">[</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">])</span>

        <span class="c1"># Create the folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path2output</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_time_u</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path2output</span><span class="si">}</span><span class="s2">/ws_</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">mv</span><span class="o">.</span><span class="n">setoutput</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">png_output</span><span class="p">(</span><span class="n">output_width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">output_name</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span> <span class="n">output_font_scale</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">mv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ws</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">view</span><span class="p">,</span> <span class="n">diff_cont</span><span class="p">)</span> </div>


    <span class="c1"># create plots of the time series of wind speed at 10m</span>
<div class="viewcode-block" id="gribdata.windspeed_plot_timeseries_10m">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.windspeed_plot_timeseries_10m">[docs]</a>
    <span class="k">def</span> <span class="nf">windspeed_plot_timeseries_10m</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path2output</span><span class="o">=</span><span class="s2">&quot;./snapshots_ws10&quot;</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot time series of 10 wind speed. Data must be defined on single levels.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path2output : str</span>
<span class="sd">            The path to the output directory.</span>
<span class="sd">        var : str</span>
<span class="sd">            The variable to plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get wind speed at 500 hPa</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">windspeed_extract_timeseries_10m</span><span class="p">()</span>  

        <span class="c1"># get number of time samples </span>
        <span class="n">n_time_u</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
        
        <span class="c1"># get min max value of the variable</span>
        <span class="n">min_val</span> <span class="o">=</span>  <span class="mf">1000000.0</span>
        <span class="n">max_val</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1000000.0</span>

        <span class="c1"># get min a max value of the variable</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_time_u</span><span class="p">):</span>
            <span class="n">min_val</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">mv</span><span class="o">.</span><span class="n">minvalue</span><span class="p">(</span><span class="n">ws</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_val</span><span class="p">,</span> <span class="n">mv</span><span class="o">.</span><span class="n">maxvalue</span><span class="p">(</span><span class="n">ws</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># define plot settings </span>
        <span class="p">[</span><span class="n">view</span><span class="p">,</span> <span class="n">diff_cont</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">def_mv_plot_settings</span><span class="p">(</span><span class="n">minmax</span><span class="o">=</span><span class="p">[</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">])</span>

        <span class="c1"># Create the folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path2output</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_time_u</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path2output</span><span class="si">}</span><span class="s2">/ws10_</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">mv</span><span class="o">.</span><span class="n">setoutput</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">png_output</span><span class="p">(</span><span class="n">output_width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">output_name</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span> <span class="n">output_font_scale</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">mv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ws</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">view</span><span class="p">,</span> <span class="n">diff_cont</span><span class="p">)</span> </div>


    <span class="c1"># create plots of the time series of given variable defined on single levels</span>
<div class="viewcode-block" id="gribdata.variable_plot_timeseries_slv">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.variable_plot_timeseries_slv">[docs]</a>
    <span class="k">def</span> <span class="nf">variable_plot_timeseries_slv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path2output</span><span class="o">=</span><span class="s2">&quot;./snapshots_slv&quot;</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;sp&quot;</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot time series of variable defined on single levels.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path2output : str</span>
<span class="sd">            The path to the output directory.</span>
<span class="sd">        var : str</span>
<span class="sd">            The variable to plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get variable</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_extract_timeseries_slv</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>  

        <span class="c1"># get number of time samples </span>
        <span class="n">n_time_u</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        
        <span class="c1"># Create the folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path2output</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># get min max value of the variable</span>
        <span class="n">min_val</span> <span class="o">=</span>  <span class="mf">1000000.0</span>
        <span class="n">max_val</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1000000.0</span>

        <span class="c1"># get min a max value of the variable</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_time_u</span><span class="p">):</span>
            <span class="n">min_val</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">mv</span><span class="o">.</span><span class="n">minvalue</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_val</span><span class="p">,</span> <span class="n">mv</span><span class="o">.</span><span class="n">maxvalue</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># define plot settings </span>
        <span class="p">[</span><span class="n">view</span><span class="p">,</span> <span class="n">diff_cont</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">def_mv_plot_settings</span><span class="p">(</span><span class="n">minmax</span><span class="o">=</span><span class="p">[</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_time_u</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path2output</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">mv</span><span class="o">.</span><span class="n">setoutput</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">png_output</span><span class="p">(</span><span class="n">output_width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">output_name</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span> <span class="n">output_font_scale</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">mv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">view</span><span class="p">,</span> <span class="n">diff_cont</span><span class="p">)</span> </div>


    <span class="c1"># compute wind stats at a point given wind components </span>
<div class="viewcode-block" id="gribdata.compute_wind_stats">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.compute_wind_stats">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_wind_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute wind statistics.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        point : list of float</span>
<span class="sd">            The latitude and longitude of the point.</span>
<span class="sd">        time : list of datetime</span>
<span class="sd">            The time series.</span>
<span class="sd">        hlevs : list of float</span>
<span class="sd">            The height levels.</span>
<span class="sd">        u_1d : list of float</span>
<span class="sd">            The u-component of the wind.</span>
<span class="sd">        v_1d : list of float</span>
<span class="sd">            The v-component of the wind.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DataFrame</span>
<span class="sd">            The wind statistics.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">point</span> <span class="o">=</span> <span class="p">[</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">]</span>
        <span class="n">n_time_u</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">n_time_v</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n_time_u</span> <span class="o">!=</span> <span class="n">n_time_v</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;u and v cannot have different lengths&quot;</span><span class="p">)</span>
        
        <span class="n">ws_loc</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">u_loc</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">v_loc</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dir_loc</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">time</span>    <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># get components of wind at the given point</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_time_u</span><span class="p">):</span>
            <span class="n">u_loc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">point</span><span class="p">))</span> 
            <span class="n">v_loc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">point</span><span class="p">))</span> 
            <span class="n">ws_loc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u_loc</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">u_loc</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">v_loc</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">v_loc</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>   
            <span class="n">dir_loc</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u_loc</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">v_loc</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">360</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="c1"># get day numbers </span>
        <span class="n">day_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">day</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">time</span><span class="p">]</span>

        <span class="c1"># remove duplicates </span>
        <span class="n">day_numbers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">day_numbers</span><span class="p">))</span>

        <span class="c1"># create date time object for plot x axis </span>
        <span class="n">year</span>             <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span>
        <span class="n">month</span>            <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">month</span>
        <span class="n">datetime_objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span> <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">day_numbers</span><span class="p">]</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">ws_loc</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Wind speed [m/s]&#39;</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">dir_loc</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Wind Dir [deg]&#39;</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">v_loc</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;V component wind [m/s]&#39;</span><span class="p">)</span>

        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">u_loc</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;U component wind [m/s]&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">datetime_objects</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m-%y&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">datetime_objects</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;10m_wind_tseries.png&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


        <span class="c1"># Define the number of sectors (20 degrees each)</span>
        <span class="n">bin_step</span>    <span class="o">=</span> <span class="mi">20</span>
        <span class="n">num_sectors</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">//</span> <span class="mi">20</span>
        <span class="n">bins</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="n">num_sectors</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">maxmag</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ws_loc</span><span class="p">)</span>

        <span class="c1"># Calculate the histogram for wind directions</span>
        <span class="n">hist</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">dir_loc</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>

        <span class="c1"># Calculate the probability for each sector</span>
        <span class="n">probabilities</span>   <span class="o">=</span> <span class="n">hist</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dir_loc</span><span class="p">)</span>

        <span class="c1"># Create the wind rose plot</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="s1">&#39;polar&#39;</span><span class="p">})</span>

        <span class="c1"># find angles corresponding to middle of each sector</span>
        <span class="n">angles</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bin_step</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>  
        <span class="n">bars</span>    <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">bin_step</span><span class="o">*</span><span class="mf">0.9</span><span class="p">),</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">probabilities</span>
        <span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

        <span class="c1"># Remove probability labels</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

        <span class="c1"># set the direction of the wind rose (clockwise)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_theta_direction</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># set the location of 0 degrees to the top (north)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_theta_offset</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wind dir. distrib. at [lat,lon]: [</span><span class="si">{</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>

        <span class="c1"># Calculate the most likely magnitude, average and standard deviation for each sector</span>
        <span class="n">most_likely_magnitudes</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">average_magnitudes</span>       <span class="o">=</span> <span class="p">[]</span>
        <span class="n">std_deviation_magnitudes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">max_magnitudes</span>           <span class="o">=</span> <span class="p">[]</span>
        <span class="n">min_magnitudes</span>           <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sectors</span><span class="p">):</span>
            <span class="n">sector_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">dir_loc</span> <span class="o">&gt;=</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dir_loc</span> <span class="o">&lt;</span> <span class="n">bins</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">sector_mask</span><span class="p">):</span>
                <span class="n">most_likely_magnitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ws_loc</span><span class="p">)[</span><span class="n">sector_mask</span><span class="p">]))</span>
                <span class="n">average_magnitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ws_loc</span><span class="p">)[</span><span class="n">sector_mask</span><span class="p">]))</span>
                <span class="n">std_deviation_magnitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ws_loc</span><span class="p">)[</span><span class="n">sector_mask</span><span class="p">]))</span>
                <span class="n">max_magnitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ws_loc</span><span class="p">)[</span><span class="n">sector_mask</span><span class="p">]))</span>
                <span class="n">min_magnitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ws_loc</span><span class="p">)[</span><span class="n">sector_mask</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">most_likely_magnitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">average_magnitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">std_deviation_magnitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">max_magnitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">min_magnitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Create the polar plot for most likely magnitudes</span>
        <span class="n">bars</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">most_likely_magnitudes</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">bin_step</span><span class="o">*</span><span class="mf">0.9</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_theta_direction</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_theta_offset</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Wind most likely mag [m/s]&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxmag</span><span class="p">)</span>

        <span class="c1"># Create the polar plot for wind mean </span>
        <span class="n">bars</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">average_magnitudes</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">bin_step</span><span class="o">*</span><span class="mf">0.9</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_theta_direction</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_theta_offset</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Wind mean [m/s]&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxmag</span><span class="p">)</span>

        <span class="c1"># Create the polar plot for wind std</span>
        <span class="n">bars</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">std_deviation_magnitudes</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">bin_step</span><span class="o">*</span><span class="mf">0.9</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_theta_direction</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_theta_offset</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Wind std. deviation [m/s]&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxmag</span><span class="p">)</span>

        <span class="c1"># Create the polar plot for max wind</span>
        <span class="n">bars</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">max_magnitudes</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">bin_step</span><span class="o">*</span><span class="mf">0.9</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_theta_direction</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_theta_offset</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Wind max [m/s]&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxmag</span><span class="p">)</span>

        <span class="c1"># Create the polar plot for min wind</span>
        <span class="n">bars</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">min_magnitudes</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">bin_step</span><span class="o">*</span><span class="mf">0.9</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_theta_direction</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_theta_offset</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Wind min [m/s]&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxmag</span><span class="p">)</span>

        <span class="c1"># Save the plot to a file</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;10m_wind_stats.png&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> </div>

    
    <span class="c1"># compute theta time series at a point </span>
<div class="viewcode-block" id="gribdata.theta_extract_timeseries">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.theta_extract_timeseries">[docs]</a>
    <span class="k">def</span> <span class="nf">theta_extract_timeseries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">hlevs</span><span class="p">,</span> <span class="n">hourly_step</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract potential temperature time series.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        point : list of float</span>
<span class="sd">            The latitude and longitude of the point.</span>
<span class="sd">        hlevs : list of float</span>
<span class="sd">            The height levels.</span>
<span class="sd">        hourly_step : int, optional</span>
<span class="sd">            The hourly step for extraction (default is 1).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            The time series and potential temperature data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check if we actually have levels</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">==</span> <span class="s2">&quot;single&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;theta_extract_timeseries only supports prefix=levels&quot;</span><span class="p">)</span>
        
        <span class="k">if</span><span class="p">(</span><span class="n">hlevs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot interpolate to ground level from grib file, increase starting level. Ground temp will be linearly extrapolated&quot;</span><span class="p">)</span>

        <span class="n">filenames_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filenames</span><span class="p">()</span>

        <span class="c1"># potential temperature &amp; time vector </span>
        <span class="n">th_1d</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">time</span>  <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># this is pretty slow, might want to speed up </span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filenames_l</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">mv</span><span class="o">.</span><span class="n">exist</span><span class="p">(</span><span class="n">filenames_l</span><span class="p">[</span><span class="n">f</span><span class="p">]):</span>

                <span class="c1"># print info </span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing file &quot;</span> <span class="o">+</span> <span class="n">filenames_l</span><span class="p">[</span><span class="n">f</span><span class="p">])</span>

                <span class="c1"># get fieldsets defined on levels </span>
                <span class="n">g</span>     <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filenames_l</span><span class="p">[</span><span class="n">f</span><span class="p">])</span>

                <span class="c1"># get available times </span>
                <span class="n">times</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">valid_date</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>

                <span class="c1"># for each time extract temperature and geopotential profiles at latlon points</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)):</span>

                    <span class="k">if</span> <span class="n">t</span> <span class="o">%</span> <span class="n">hourly_step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; -&gt; time &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
                        
                        <span class="c1"># extract temperature at time t</span>
                        <span class="n">t_3d_t_pl</span>  <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">shortName</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">validityDateTime</span><span class="o">=</span><span class="n">times</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>

                        <span class="c1"># get potential temperature field (ps should be encoded in the grib)</span>
                        <span class="n">th_3d_t_pl</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">pott_p</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">t_3d_t_pl</span><span class="p">)</span>

                        <span class="c1"># extract potential temperature and geopotential at time t</span>
                        <span class="n">zg_3d_pl</span>   <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">shortName</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">validityDateTime</span><span class="o">=</span><span class="n">times</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> 
                        
                        <span class="c1"># extract potential temperature at time t</span>
                        <span class="n">th_3d_t_ml</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="n">ml_to_hl</span><span class="p">(</span><span class="n">th_3d_t_pl</span><span class="p">,</span> <span class="n">zg_3d_pl</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">hlevs</span><span class="p">,</span> <span class="s2">&quot;sea&quot;</span><span class="p">,</span> <span class="s2">&quot;linear&quot;</span><span class="p">)</span>

                        <span class="c1"># interpolate at lat-lon location</span>
                        <span class="n">th_1d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">th_3d_t_ml</span><span class="p">,</span> <span class="n">point</span><span class="p">))</span>

                        <span class="c1"># add time to the list </span>
                        <span class="n">time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot open file &quot;</span> <span class="o">+</span> <span class="n">filenames_l</span><span class="p">[</span><span class="n">f</span><span class="p">])</span>  

        <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">th_1d</span>    </div>


    <span class="c1"># compute theta stats at a point from current dataset </span>
<div class="viewcode-block" id="gribdata.compute_theta_stats">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.compute_theta_stats">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_theta_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">hlevs</span><span class="p">,</span> <span class="n">th_1d</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute potential temperature statistics.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        point : list of float</span>
<span class="sd">            The latitude and longitude of the point.</span>
<span class="sd">        time : list of datetime</span>
<span class="sd">            The time series.</span>
<span class="sd">        hlevs : list of float</span>
<span class="sd">            The height levels.</span>
<span class="sd">        th_1d : list of float</span>
<span class="sd">            The potential temperature data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DataFrame</span>
<span class="sd">            The potential temperature statistics.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># fit a pice-wise linear model to the potential temperature profile</span>
        <span class="n">params</span>      <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Create output folder</span>
        <span class="n">path2output</span> <span class="o">=</span> <span class="s2">&quot;theta_fit&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path2output</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)):</span>

            <span class="c1"># check if first element is None and iterate until we find a valid value</span>
            <span class="k">if</span><span class="p">(</span><span class="n">th_1d</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="n">th_1d</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># save new profiles into a list where None values are excluded </span>
            <span class="n">th_1d_valid</span> <span class="o">=</span> <span class="n">th_1d</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">:]</span>
            <span class="n">hlevs_valid</span> <span class="o">=</span> <span class="n">hlevs</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
                
            <span class="c1"># compute some quantities to define the bounds </span>
            <span class="n">gamma_tot</span>    <span class="o">=</span> <span class="p">(</span><span class="n">th_1d_valid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">th_1d_valid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">hlevs_valid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">hlevs_valid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">theta_ref</span>    <span class="o">=</span> <span class="n">th_1d_valid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">th_1d_valid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">th_1d_valid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">hlevs_valid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">hlevs_valid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">hlevs_valid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">gamma_ground</span> <span class="o">=</span> <span class="p">(</span><span class="n">th_1d_valid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">th_1d_valid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">hlevs_valid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">hlevs_valid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="c1"># set the initial guess </span>
            <span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="n">theta_ref</span><span class="p">,</span>  <span class="n">gamma_ground</span><span class="p">,</span>  <span class="n">gamma_tot</span><span class="p">,</span> <span class="n">gamma_tot</span><span class="o">*</span><span class="mi">250</span><span class="p">,</span> <span class="mf">500.0</span><span class="p">,</span> <span class="mf">250.0</span><span class="p">]</span>  

            <span class="c1"># Fit the model to the data</span>
            <span class="n">lower_bounds</span> <span class="o">=</span>  <span class="p">[</span><span class="n">theta_ref</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">gamma_ground</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">gamma_tot</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">,</span>   <span class="n">gamma_tot</span><span class="o">*</span><span class="mi">250</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span>    <span class="mf">249.9999</span><span class="p">]</span>
            <span class="n">upper_bounds</span> <span class="o">=</span>  <span class="p">[</span><span class="n">theta_ref</span><span class="o">+</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">gamma_ground</span><span class="o">+</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">gamma_tot</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span>   <span class="mf">10.0</span><span class="p">,</span>           <span class="mf">5000.0</span><span class="p">,</span> <span class="mf">250.0001</span><span class="p">]</span>


            <span class="n">params_t</span><span class="p">,</span> <span class="n">params_covariance_t</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">piecewise_linear_potential_theta</span><span class="p">,</span>
                    <span class="n">hlevs_valid</span><span class="p">,</span>
                    <span class="n">th_1d_valid</span><span class="p">,</span>
                    <span class="n">p0</span><span class="o">=</span><span class="n">initial_guess</span><span class="p">,</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params_t</span><span class="p">)</span>
            <span class="c1"># Print the fitted parameters</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fitted parameters:&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>

            <span class="c1"># Plot the data and the fitted model</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">th_1d_valid</span><span class="p">,</span> <span class="n">hlevs_valid</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">piecewise_linear_potential_theta</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hlevs</span><span class="p">),</span> <span class="o">*</span><span class="n">params</span><span class="p">[</span><span class="n">t</span><span class="p">]),</span> <span class="n">hlevs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fitted model&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Height (m)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Temperature (°C)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Vertical Profile of Temperature&#39;</span><span class="p">)</span>
            
            <span class="c1"># Save the plot to a file</span>
            <span class="n">filename</span>    <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path2output</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 

        <span class="c1"># Convert params to DataFrame</span>
        <span class="n">params_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">color_levels</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>
        <span class="n">param_names</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;theta_ref&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma_abl&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;dtheta_inv&#39;</span><span class="p">,</span> <span class="s1">&#39;z_inv&#39;</span><span class="p">]</span>
        <span class="n">param_lgnd</span>   <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\theta_{\mathrm</span><span class="si">{ref}</span><span class="s1">}$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\gamma_{\mathrm</span><span class="si">{ABL}</span><span class="s1">}$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\gamma$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Delta\theta$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$H$&#39;</span><span class="p">]</span>
        <span class="n">df_params</span>    <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">params_array</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">param_names</span><span class="p">)</span>

        <span class="c1"># Enable LaTeX rendering</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">)</span>

        <span class="c1"># Create pairplot</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">PairGrid</span><span class="p">(</span><span class="n">df_params</span><span class="p">,</span> <span class="n">diag_sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">corner</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Define a function to add vertical bars on the diagonal</span>
        <span class="k">def</span> <span class="nf">diag_mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">median</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">median</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Define a function to add vertical and horizontal bars in the subdiagonal plots</span>
        <span class="k">def</span> <span class="nf">off_diag_mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">median_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
            <span class="n">median_y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
            <span class="n">mean_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">mean_y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">median_x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">median_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean_x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">mean_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Map the functions to the grid</span>
        <span class="n">g</span><span class="o">.</span><span class="n">map_diag</span><span class="p">(</span><span class="n">diag_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">map_offdiag</span><span class="p">(</span><span class="n">off_diag_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_levels</span><span class="p">)</span>

        <span class="c1"># Update axis labels with LaTeX notation</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">param_lgnd</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">param_lgnd</span><span class="p">)]</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">param_lgnd</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">param_lgnd</span><span class="p">)]</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="c1"># Add title in the top right of the diagram</span>
        <span class="n">time_interval</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">title_text</span>    <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Potential temperature individual and joint statistics</span><span class="se">\n</span><span class="s2">at latitude: </span><span class="si">{</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> deg, longitude: </span><span class="si">{</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> deg</span><span class="se">\n</span><span class="s2">time interval: </span><span class="si">{</span><span class="n">time_interval</span><span class="si">}</span><span class="se">\n</span><span class="s2">Dashed line: median, dotted line: mean&quot;</span>

        <span class="c1"># Calculate the position for the text</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>  <span class="c1"># Adjust the top to make space for the title</span>
        <span class="n">g</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">title_text</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Show plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Save the plot to a file</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;theta_stats.png&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df_params</span></div>


    <span class="c1"># provides a picewise-linear potential temperature models given lapse rate, surface temp, inversion height/strength and free atm lapse rate </span>
<div class="viewcode-block" id="gribdata.piecewise_linear_potential_theta">
<a class="viewcode-back" href="../../pre.html#pre.gribviz.gribdata.piecewise_linear_potential_theta">[docs]</a>
    <span class="k">def</span> <span class="nf">piecewise_linear_potential_theta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">theta_ref</span><span class="p">,</span> <span class="n">gamma_abl</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">dtheta_inv</span><span class="p">,</span> <span class="n">z_inv</span><span class="p">,</span> <span class="n">delta_inv</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the piecewise-linear potential temperature model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        z : float</span>
<span class="sd">            The height.</span>
<span class="sd">        theta_ref : float</span>
<span class="sd">            The reference potential temperature.</span>
<span class="sd">        gamma_abl : float</span>
<span class="sd">            The adiabatic lapse rate in the atmospheric boundary layer.</span>
<span class="sd">        gamma : float</span>
<span class="sd">            The free atmospheric lapse rate.</span>
<span class="sd">        dtheta_inv : float</span>
<span class="sd">            The potential temperature inversion strength.</span>
<span class="sd">        z_inv : float</span>
<span class="sd">            The height of the inversion.</span>
<span class="sd">        delta_inv : float</span>
<span class="sd">            The inversion width.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The potential temperature profile on z.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">half_inv</span>  <span class="o">=</span> <span class="n">delta_inv</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">z_inv_lo</span>  <span class="o">=</span> <span class="n">z_inv</span> <span class="o">-</span> <span class="n">half_inv</span>
        <span class="n">z_inv_hi</span>  <span class="o">=</span> <span class="n">z_inv</span> <span class="o">+</span> <span class="n">half_inv</span>
        <span class="n">gamma_inv</span> <span class="o">=</span> <span class="n">dtheta_inv</span> <span class="o">/</span> <span class="n">delta_inv</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">z_inv_lo</span><span class="p">):</span>
                <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta_ref</span> <span class="o">+</span> <span class="n">gamma_abl</span> <span class="o">*</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">z_inv_hi</span> <span class="ow">and</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">z_inv_lo</span><span class="p">):</span>
                <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta_ref</span> <span class="o">+</span> <span class="n">gamma_abl</span> <span class="o">*</span> <span class="n">z_inv_lo</span> <span class="o">+</span> <span class="n">gamma_inv</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">z_inv_lo</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta_ref</span> <span class="o">+</span> <span class="n">gamma_abl</span> <span class="o">*</span> <span class="n">z_inv_lo</span> <span class="o">+</span> <span class="n">dtheta_inv</span> <span class="o">+</span> <span class="n">gamma</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">z_inv_hi</span><span class="p">)</span>
            
        <span class="k">return</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></div>
</div>

    
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Sebastiano Stipa.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>